<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WellWallet Marketing Gantt Chart</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0D9488;
            --primary-dark: #0F766E;
            --primary-light: #14B8A6;
            --secondary: #059669;
            --accent: #F59E0B;
            --accent-light: #FBBF24;
            
            --bg-dark: #0F172A;
            --bg-card: #1E293B;
            --bg-card-light: #334155;
            --text-primary: #F8FAFC;
            --text-secondary: #94A3B8;
            --text-muted: #64748B;
            
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            --ruth-color: #0EA5E9;
            --dara-color: #8B5CF6;
            --founders-color: #0D9488;
            --sales-color: #F59E0B;
            --sarah-color: #EC4899;
            --samuel-color: #6366F1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a2744 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }
        
        /* Header */
        .header {
            background: linear-gradient(90deg, var(--primary-dark), var(--primary));
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .brand-text h1 {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }
        
        .brand-text p {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.8);
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .btn-primary {
            background: white;
            color: var(--primary);
        }
        
        .btn-primary:hover {
            background: var(--accent);
            color: var(--bg-dark);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.25);
        }
        
        .btn-milestone {
            background: var(--accent);
            color: var(--bg-dark);
        }
        
        .btn-milestone:hover {
            background: var(--accent-light);
        }
        
        /* Container */
        .container {
            padding: 25px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* Stats Bar - CLICKABLE */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 18px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: 'Click to view';
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.7rem;
            color: var(--primary-light);
            transition: bottom 0.3s ease;
            padding: 5px;
            background: var(--bg-card-light);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
        }
        
        .stat-card:hover::before {
            bottom: 0;
        }
        
        .stat-card .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 12px;
        }
        
        .stat-card .stat-icon.total { background: rgba(13, 148, 136, 0.2); }
        .stat-card .stat-icon.progress { background: rgba(59, 130, 246, 0.2); }
        .stat-card .stat-icon.completed { background: rgba(16, 185, 129, 0.2); }
        .stat-card .stat-icon.blocked { background: rgba(239, 68, 68, 0.2); }
        .stat-card .stat-icon.notstarted { background: rgba(148, 163, 184, 0.2); }
        .stat-card .stat-icon.milestones { background: rgba(245, 158, 11, 0.2); }
        
        .stat-card .number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
        }
        
        .stat-card .label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 3px;
        }
        
        /* Controls Section */
        .controls-section {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 20px;
            border: 1px solid var(--bg-card-light);
        }
        
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .controls-row:last-child {
            margin-bottom: 0;
        }
        
        .controls-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-right: 5px;
        }
        
        .btn-view {
            background: var(--bg-card-light);
            color: var(--text-primary);
            padding: 8px 14px;
            font-size: 0.8rem;
        }
        
        .btn-view:hover, .btn-view.active {
            background: var(--primary);
            color: white;
        }
        
        .btn-filter {
            padding: 6px 12px;
            font-size: 0.75rem;
            border-radius: 20px;
            color: white;
        }
        
        .btn-filter.all { background: var(--bg-card-light); }
        .btn-filter.all:hover, .btn-filter.all.active { background: var(--primary); }
        
        .btn-filter.ruth { background: rgba(14, 165, 233, 0.4); border: 1px solid var(--ruth-color); }
        .btn-filter.ruth:hover, .btn-filter.ruth.active { background: var(--ruth-color); }
        
        .btn-filter.dara { background: rgba(139, 92, 246, 0.4); border: 1px solid var(--dara-color); }
        .btn-filter.dara:hover, .btn-filter.dara.active { background: var(--dara-color); }
        
        .btn-filter.founders { background: rgba(13, 148, 136, 0.4); border: 1px solid var(--founders-color); }
        .btn-filter.founders:hover, .btn-filter.founders.active { background: var(--founders-color); }
        
        .btn-filter.sales { background: rgba(245, 158, 11, 0.4); border: 1px solid var(--sales-color); }
        .btn-filter.sales:hover, .btn-filter.sales.active { background: var(--sales-color); }
        
        .btn-filter.sarah { background: rgba(236, 72, 153, 0.4); border: 1px solid var(--sarah-color); }
        .btn-filter.sarah:hover, .btn-filter.sarah.active { background: var(--sarah-color); }
        
        .btn-filter.samuel { background: rgba(99, 102, 241, 0.4); border: 1px solid var(--samuel-color); }
        .btn-filter.samuel:hover, .btn-filter.samuel.active { background: var(--samuel-color); }
        
        /* Calendar Navigation */
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-card-light);
            padding: 8px 15px;
            border-radius: 10px;
        }
        
        .nav-btn {
            background: var(--bg-card);
            border: none;
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .nav-btn:hover {
            background: var(--primary);
        }
        
        .current-period {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 180px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .today-btn {
            background: var(--primary);
            color: white;
            padding: 6px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .today-btn:hover {
            background: var(--primary-light);
        }
        
        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 12px 18px;
            background: var(--bg-card);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }
        
        /* CUSTOM GANTT CHART */
        .gantt-container {
            background: white;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 25px;
        }
        
        .gantt-header {
            display: flex;
            background: #f1f5f9;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .gantt-header-task {
            min-width: 300px;
            max-width: 300px;
            padding: 12px 15px;
            font-weight: 600;
            color: #334155;
            background: #e2e8f0;
            border-right: 2px solid #cbd5e1;
        }
        
        .gantt-header-dates {
            display: flex;
            flex: 1;
            overflow-x: auto;
        }
        
        .gantt-date-cell {
            min-width: 40px;
            padding: 8px 4px;
            text-align: center;
            font-size: 0.7rem;
            color: #64748B;
            border-right: 1px solid #e2e8f0;
        }
        
        .gantt-date-cell.today {
            background: rgba(13, 148, 136, 0.2);
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .gantt-date-cell.weekend {
            background: #f8fafc;
        }
        
        .gantt-date-cell .day-name {
            font-size: 0.65rem;
            color: #94A3B8;
        }
        
        .gantt-date-cell .day-num {
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .gantt-body {
            max-height: 500px;
            overflow: auto;
        }
        
        .gantt-scroll-wrapper {
            display: flex;
            min-width: fit-content;
        }
        
        .gantt-task-list {
            min-width: 300px;
            max-width: 300px;
            background: #f8fafc;
            border-right: 2px solid #e2e8f0;
            position: sticky;
            left: 0;
            z-index: 5;
        }
        
        .gantt-task-item {
            padding: 10px 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
            min-height: 50px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .gantt-task-item:hover {
            background: #e2e8f0;
        }
        
        .gantt-task-item .owner-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .gantt-task-item .task-name {
            font-size: 0.8rem;
            color: #1e293b;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .gantt-task-item .priority-badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .priority-P0 { background: #FEE2E2; color: #DC2626; }
        .priority-P1 { background: #FEF3C7; color: #D97706; }
        .priority-P2 { background: #DBEAFE; color: #2563EB; }
        .priority-P3 { background: #D1FAE5; color: #059669; }
        
        .gantt-bars-container {
            flex: 1;
        }
        
        .gantt-bar-row {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            min-height: 50px;
            position: relative;
        }
        
        .gantt-bar-cell {
            min-width: 40px;
            border-right: 1px solid #f1f5f9;
            position: relative;
        }
        
        .gantt-bar-cell.weekend {
            background: #f8fafc;
        }
        
        .gantt-bar-cell.today {
            background: rgba(13, 148, 136, 0.1);
        }
        
        .gantt-bar {
            position: absolute;
            top: 10px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #1e293b !important;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .gantt-bar:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .gantt-bar .bar-progress {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            border-radius: 6px 0 0 6px;
            opacity: 0.5;
        }
        
        .gantt-bar .bar-text {
            position: relative;
            z-index: 1;
        }
        
        /* Bar colors by owner */
        .bar-ruth { background: #BAE6FD; }
        .bar-ruth .bar-progress { background: #0EA5E9; }
        
        .bar-dara { background: #DDD6FE; }
        .bar-dara .bar-progress { background: #8B5CF6; }
        
        .bar-founders { background: #99F6E4; }
        .bar-founders .bar-progress { background: #14B8A6; }
        
        .bar-sales { background: #FDE68A; }
        .bar-sales .bar-progress { background: #F59E0B; }
        
        .bar-sarah { background: #FBCFE8; }
        .bar-sarah .bar-progress { background: #EC4899; }
        
        .bar-samuel { background: #C7D2FE; }
        .bar-samuel .bar-progress { background: #6366F1; }
        
        .bar-multiple { background: #E2E8F0; }
        .bar-multiple .bar-progress { background: #64748B; }
        
        /* Milestones Section */
        .milestones-section {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid var(--bg-card-light);
            margin-bottom: 25px;
        }
        
        .milestones-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }
        
        .milestones-header h2 {
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }
        
        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 15px;
        }
        
        .milestone-card {
            background: var(--bg-card-light);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--accent);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .milestone-card:hover {
            transform: translateX(5px);
        }
        
        .milestone-card.completed {
            border-left-color: var(--success);
        }
        
        .milestone-card .milestone-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            padding-right: 25px;
            font-size: 0.95rem;
        }
        
        .milestone-card .milestone-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .milestone-card .progress-bar {
            flex: 1;
            height: 6px;
            background: var(--bg-card);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .milestone-card .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .milestone-card .progress-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 40px;
        }
        
        .milestone-card .task-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .milestone-card .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .milestone-card:hover .delete-btn {
            opacity: 1;
        }
        
        .milestone-card .delete-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            width: 100%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--bg-card-light);
        }
        
        .modal.large {
            max-width: 800px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.2rem;
        }
        
        .close-btn {
            background: var(--bg-card-light);
            border: none;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--bg-card-light);
            border-radius: 8px;
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .task-selection {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--bg-card-light);
            border-radius: 8px;
            padding: 8px;
            background: var(--bg-dark);
        }
        
        .task-selection-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .task-selection-item:hover {
            background: var(--bg-card-light);
        }
        
        .task-selection-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
        }
        
        .task-selection-item label {
            flex: 1;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-primary);
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-actions .btn {
            flex: 1;
            padding: 12px;
        }
        
        .btn-save {
            background: var(--primary);
            color: white;
        }
        
        .btn-save:hover {
            background: var(--primary-light);
        }
        
        .btn-cancel {
            background: var(--bg-card-light);
            color: var(--text-primary);
        }
        
        .btn-delete {
            background: var(--danger);
            color: white;
            flex: 0.5;
        }
        
        /* Task List Modal */
        .task-list-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .task-list-item {
            background: var(--bg-card-light);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .task-list-item:hover {
            background: var(--bg-dark);
            transform: translateX(5px);
        }
        
        .task-list-item .owner-indicator {
            width: 8px;
            height: 40px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .task-list-item .task-info {
            flex: 1;
        }
        
        .task-list-item .task-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .task-list-item .task-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .task-list-item .task-progress {
            width: 60px;
            text-align: center;
        }
        
        .task-list-item .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0 auto;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        /* FAB */
        .fab-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-end;
        }
        
        .fab {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fab-task {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        .fab-milestone {
            background: linear-gradient(135deg, var(--accent), #D97706);
            width: 44px;
            height: 44px;
            font-size: 1.1rem;
        }
        
        .fab:hover {
            transform: scale(1.1);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .calendar-nav {
                justify-content: center;
            }
            
            .gantt-header-task,
            .gantt-task-list {
                min-width: 200px;
                max-width: 200px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">W</div>
            <div class="brand-text">
                <h1>WellWallet</h1>
                <p>Marketing Task Manager</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="exportTasks()">üì• Export</button>
            <button class="btn btn-milestone" onclick="openMilestoneModal()">üéØ Milestone</button>
            <button class="btn btn-primary" onclick="openTaskModal()">+ Add Task</button>
        </div>
    </header>
    
    <div class="container">
        <!-- Stats Bar - CLICKABLE -->
        <div class="stats-bar">
            <div class="stat-card" onclick="showTasksByStatus('all')">
                <div class="stat-icon total">üìã</div>
                <div class="number" id="total-tasks">0</div>
                <div class="label">Total Tasks</div>
            </div>
            <div class="stat-card" onclick="showTasksByStatus('not-started')">
                <div class="stat-icon notstarted">‚è≥</div>
                <div class="number" id="not-started">0</div>
                <div class="label">Not Started</div>
            </div>
            <div class="stat-card" onclick="showTasksByStatus('in-progress')">
                <div class="stat-icon progress">üîÑ</div>
                <div class="number" id="in-progress">0</div>
                <div class="label">In Progress</div>
            </div>
            <div class="stat-card" onclick="showTasksByStatus('completed')">
                <div class="stat-icon completed">‚úÖ</div>
                <div class="number" id="completed-tasks">0</div>
                <div class="label">Completed</div>
            </div>
            <div class="stat-card" onclick="showTasksByStatus('blocked')">
                <div class="stat-icon blocked">üö´</div>
                <div class="number" id="blocked-tasks">0</div>
                <div class="label">Blocked</div>
            </div>
            <div class="stat-card" onclick="showMilestonesList()">
                <div class="stat-icon milestones">üéØ</div>
                <div class="number" id="total-milestones">0</div>
                <div class="label">Milestones</div>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls-section">
            <div class="controls-row">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="navigateCalendar(-7)" title="Previous Week">‚è™</button>
                    <button class="nav-btn" onclick="navigateCalendar(-1)" title="Previous Day">‚óÄ</button>
                    <span class="current-period" id="currentPeriod">Loading...</span>
                    <button class="nav-btn" onclick="navigateCalendar(1)" title="Next Day">‚ñ∂</button>
                    <button class="nav-btn" onclick="navigateCalendar(7)" title="Next Week">‚è©</button>
                    <button class="today-btn" onclick="goToToday()">Today</button>
                </div>
                
                <div class="controls-group">
                    <span class="controls-label">View:</span>
                    <button class="btn btn-view active" onclick="changeView(14, this)">2 Weeks</button>
                    <button class="btn btn-view" onclick="changeView(30, this)">Month</button>
                    <button class="btn btn-view" onclick="changeView(60, this)">2 Months</button>
                </div>
            </div>
            
            <div class="controls-row">
                <div class="controls-group">
                    <span class="controls-label">Team:</span>
                    <button class="btn btn-filter all active" onclick="filterTasks('all', this)">All</button>
                    <button class="btn btn-filter ruth" onclick="filterTasks('ruth', this)">Ruth</button>
                    <button class="btn btn-filter dara" onclick="filterTasks('dara', this)">Dara</button>
                    <button class="btn btn-filter founders" onclick="filterTasks('founders', this)">Founders</button>
                    <button class="btn btn-filter sales" onclick="filterTasks('sales', this)">Sales</button>
                    <button class="btn btn-filter sarah" onclick="filterTasks('sarah', this)">Sarah</button>
                    <button class="btn btn-filter samuel" onclick="filterTasks('samuel', this)">Samuel</button>
                </div>
                
                <div class="controls-group">
                    <span class="controls-label">Channel:</span>
                    <select id="channelFilter" onchange="filterByChannel(this.value)" style="padding: 6px 10px; border-radius: 6px; background: var(--bg-card-light); border: none; color: white; font-size: 0.8rem;">
                        <option value="all">All Channels</option>
                        <option value="paid">Paid & Content</option>
                        <option value="whatsapp">WhatsApp</option>
                        <option value="pharmacy">Pharmacy</option>
                        <option value="partnerships">Partnerships</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background: #BAE6FD;"></div><span>Ruth</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #DDD6FE;"></div><span>Dara</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #99F6E4;"></div><span>Founders</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #FDE68A;"></div><span>Sales</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #FBCFE8;"></div><span>Sarah</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #C7D2FE;"></div><span>Samuel</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #E2E8F0;"></div><span>Multiple</span></div>
        </div>
        
        <!-- Custom Gantt Chart -->
        <div class="gantt-container">
            <div class="gantt-header">
                <div class="gantt-header-task">Task Name</div>
                <div class="gantt-header-dates" id="ganttHeaderDates"></div>
            </div>
            <div class="gantt-body" id="ganttBody"></div>
        </div>
        
        <!-- Milestones -->
        <div class="milestones-section">
            <div class="milestones-header">
                <h2>üéØ Milestones</h2>
                <button class="btn btn-milestone" onclick="openMilestoneModal()">+ New</button>
            </div>
            <div class="milestones-grid" id="milestonesGrid"></div>
        </div>
    </div>
    
    <!-- Task Modal -->
    <div class="modal-overlay" id="taskModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="taskModalTitle">Add New Task</h2>
                <button class="close-btn" onclick="closeTaskModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>Task Name</label>
                <input type="text" id="taskName" placeholder="Enter task description">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Channel</label>
                    <select id="taskChannel">
                        <option value="paid">Paid & Content</option>
                        <option value="whatsapp">WhatsApp</option>
                        <option value="pharmacy">Pharmacy</option>
                        <option value="partnerships">Partnerships</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Campaign</label>
                    <select id="taskCampaign">
                        <option value="pay-less">Pay Less for Meds</option>
                        <option value="mom-baby">Mom & Baby</option>
                        <option value="no-insurance">No Insurance</option>
                        <option value="general">General</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Assigned To</label>
                <select id="taskOwner">
                    <option value="ruth">Ruth (Growth)</option>
                    <option value="dara">Dara (Design)</option>
                    <option value="founders">Lumi & Ijele</option>
                    <option value="sales">Cyril & Chisom</option>
                    <option value="sarah">Sarah</option>
                    <option value="samuel">Samuel</option>
                    <option value="multiple">Multiple</option>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="taskStart">
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="taskEnd">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Priority</label>
                    <select id="taskPriority">
                        <option value="P0">P0 - Critical</option>
                        <option value="P1">P1 - High</option>
                        <option value="P2">P2 - Medium</option>
                        <option value="P3">P3 - Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Progress (%)</label>
                    <input type="number" id="taskProgress" min="0" max="100" value="0">
                </div>
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select id="taskStatus">
                    <option value="not-started">Not Started</option>
                    <option value="in-progress">In Progress</option>
                    <option value="blocked">Blocked</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeTaskModal()">Cancel</button>
                <button class="btn btn-delete" id="deleteTaskBtn" onclick="deleteTask()" style="display: none;">Delete</button>
                <button class="btn btn-save" onclick="saveTask()">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Milestone Modal -->
    <div class="modal-overlay" id="milestoneModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Create Milestone</h2>
                <button class="close-btn" onclick="closeMilestoneModal()">√ó</button>
            </div>
            
            <div class="form-group">
                <label>Milestone Name</label>
                <input type="text" id="milestoneName" placeholder="e.g., Campaign 1 Launch Ready">
            </div>
            
            <div class="form-group">
                <label>Select Tasks (milestone completes when all are done)</label>
                <div class="task-selection" id="taskSelection"></div>
                <div style="margin-top: 8px; font-size: 0.8rem; color: var(--primary-light);" id="selectedCount">0 tasks selected</div>
            </div>
            
            <div class="form-group">
                <label>Target Date (Optional)</label>
                <input type="date" id="milestoneDate">
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeMilestoneModal()">Cancel</button>
                <button class="btn btn-save" onclick="saveMilestone()">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Task List Modal -->
    <div class="modal-overlay" id="taskListModal">
        <div class="modal large">
            <div class="modal-header">
                <h2 id="taskListTitle">Tasks</h2>
                <button class="close-btn" onclick="closeTaskListModal()">√ó</button>
            </div>
            <div class="task-list-container" id="taskListContainer"></div>
        </div>
    </div>
    
    <!-- FAB -->
    <div class="fab-container">
        <button class="fab fab-milestone" onclick="openMilestoneModal()">üéØ</button>
        <button class="fab fab-task" onclick="openTaskModal()">+</button>
    </div>
    
    <script>
    // ==================== API CONFIG ====================
const API_BASE = 'https://wellwallettasks-api-hwcahqdyd5dfgwg5.westeurope-01.azurewebsites.net/api';

// ==================== API FUNCTIONS ====================
async function loadTasks() {
    try {
        const response = await fetch(`${API_BASE}/getTasks`);
        if (response.ok) {
            const tasks = await response.json();
            if (tasks.length > 0) {
                allTasks = tasks;
            }
        }
    } catch (error) {
        console.log('Could not load tasks from API, using defaults');
    }
    renderGantt();
    renderMilestones();
}

async function saveTaskToAPI(task) {
    try {
        const response = await fetch(`${API_BASE}/addTask`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(task)
        });
        return await response.json();
    } catch (error) {
        console.error('Error saving task:', error);
        return null;
    }
}

async function updateTaskInAPI(task) {
    try {
        const response = await fetch(`${API_BASE}/updateTask/${task.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(task)
        });
        return await response.json();
    } catch (error) {
        console.error('Error updating task:', error);
        return null;
    }
}

async function deleteTaskFromAPI(taskId) {
    try {
        await fetch(`${API_BASE}/deleteTask/${taskId}`, {
            method: 'DELETE'
        });
    } catch (error) {
        console.error('Error deleting task:', error);
    }
}
        // ==================== DATE HELPERS ====================
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        let viewStartDate = new Date(today);
        viewStartDate.setDate(viewStartDate.getDate() - 3); // Start a few days before today
        
        let viewDays = 14; // Default 2 weeks
        let currentFilter = 'all';
        let currentChannelFilter = 'all';
        let editingTaskId = null;
        
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result.toISOString().split('T')[0];
        }
        
        function formatDate(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getDate()}`;
        }
        
        function getDaysBetween(start, end) {
            const s = new Date(start);
            const e = new Date(end);
            return Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
        }
        
        function getDayOffset(date, startDate) {
            const d = new Date(date);
            const s = new Date(startDate);
            return Math.floor((d - s) / (1000 * 60 * 60 * 24));
        }
        
        // ==================== TASK DATA ====================
        let allTasks = [
            // Campaign 1: Pay Less for Your Meds
            { id: 'paid-1', name: '[C1] Update Content Calendar', start: addDays(today, 0), end: addDays(today, 1), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'pay-less', priority: 'P0', status: 'not-started' },
            { id: 'paid-2', name: '[C1] Create 4-8 paid ads (Reels)', start: addDays(today, 2), end: addDays(today, 5), progress: 0, owner: 'dara', channel: 'paid', campaign: 'pay-less', priority: 'P1', status: 'not-started' },
            { id: 'paid-3', name: '[C1] Setup Meta Ads (55%)', start: addDays(today, 3), end: addDays(today, 4), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'pay-less', priority: 'P0', status: 'not-started' },
            { id: 'paid-4', name: '[C1] Setup TikTok Ads (25%)', start: addDays(today, 4), end: addDays(today, 5), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'pay-less', priority: 'P1', status: 'not-started' },
            { id: 'paid-5', name: '[C1] Setup Google UAC (15%)', start: addDays(today, 5), end: addDays(today, 6), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'pay-less', priority: 'P1', status: 'not-started' },
            { id: 'paid-6', name: '[C1] English + Pidgin versions', start: addDays(today, 3), end: addDays(today, 6), progress: 0, owner: 'dara', channel: 'paid', campaign: 'pay-less', priority: 'P1', status: 'not-started' },
            
            // Campaign 2: Mom & Baby
            { id: 'paid-7', name: '[C2] Update Content Calendar', start: addDays(today, 7), end: addDays(today, 8), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'mom-baby', priority: 'P2', status: 'not-started' },
            { id: 'paid-8', name: '[C2] Create 5-10 posts/ads', start: addDays(today, 8), end: addDays(today, 12), progress: 0, owner: 'dara', channel: 'paid', campaign: 'mom-baby', priority: 'P2', status: 'not-started' },
            { id: 'paid-9', name: '[C2] Launch ads (young mothers)', start: addDays(today, 12), end: addDays(today, 13), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'mom-baby', priority: 'P1', status: 'not-started' },
            
            // Campaign 3: No Insurance
            { id: 'paid-10', name: '[C3] Update Content Calendar', start: addDays(today, 14), end: addDays(today, 15), progress: 0, owner: 'ruth', channel: 'paid', campaign: 'no-insurance', priority: 'P2', status: 'not-started' },
            { id: 'paid-11', name: '[C3] Create 5-10 posts/ads', start: addDays(today, 15), end: addDays(today, 19), progress: 0, owner: 'dara', channel: 'paid', campaign: 'no-insurance', priority: 'P2', status: 'not-started' },
            
            // WhatsApp
            { id: 'wa-1', name: 'Curate 10-20 Facebook groups', start: addDays(today, 0), end: addDays(today, 3), progress: 30, owner: 'sarah', channel: 'whatsapp', campaign: 'general', priority: 'P0', status: 'in-progress' },
            { id: 'wa-2', name: 'Edit WhatsApp Business Profile', start: addDays(today, 0), end: addDays(today, 1), progress: 0, owner: 'dara', channel: 'whatsapp', campaign: 'general', priority: 'P0', status: 'not-started' },
            { id: 'wa-3', name: 'Setup automated replies', start: addDays(today, 1), end: addDays(today, 2), progress: 0, owner: 'ruth', channel: 'whatsapp', campaign: 'general', priority: 'P0', status: 'not-started' },
            { id: 'wa-4', name: 'Update Instagram with WA line', start: addDays(today, 1), end: addDays(today, 1), progress: 0, owner: 'dara', channel: 'whatsapp', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'wa-5', name: 'Create content video for WA', start: addDays(today, 4), end: addDays(today, 7), progress: 0, owner: 'multiple', channel: 'whatsapp', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'wa-6', name: 'Send DMs to Facebook users', start: addDays(today, 5), end: addDays(today, 18), progress: 0, owner: 'sarah', channel: 'whatsapp', campaign: 'general', priority: 'P1', status: 'not-started' },
            
            // Pharmacy
            { id: 'pharm-1', name: 'Contact Pharmacies for lists', start: addDays(today, 0), end: addDays(today, 3), progress: 0, owner: 'samuel', channel: 'pharmacy', campaign: 'general', priority: 'P0', status: 'not-started' },
            { id: 'pharm-2', name: 'Design Branding for Pharmacies', start: addDays(today, 2), end: addDays(today, 5), progress: 0, owner: 'multiple', channel: 'pharmacy', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'pharm-3', name: 'Design QR code posters', start: addDays(today, 3), end: addDays(today, 4), progress: 0, owner: 'dara', channel: 'pharmacy', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'pharm-4', name: 'Distribute QR to 4 pharmacies', start: addDays(today, 5), end: addDays(today, 6), progress: 0, owner: 'sales', channel: 'pharmacy', campaign: 'general', priority: 'P0', status: 'not-started' },
            { id: 'pharm-5', name: 'WhatsApp customers: Ask WellWallet', start: addDays(today, 7), end: addDays(today, 10), progress: 0, owner: 'samuel', channel: 'pharmacy', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'pharm-6', name: 'Develop referral program', start: addDays(today, 8), end: addDays(today, 12), progress: 0, owner: 'founders', channel: 'pharmacy', campaign: 'general', priority: 'P1', status: 'not-started' },
            
            // Partnerships
            { id: 'vendor-1', name: 'Curate vendor list (10-20/area)', start: addDays(today, 0), end: addDays(today, 4), progress: 0, owner: 'multiple', channel: 'partnerships', campaign: 'general', priority: 'P0', status: 'not-started' },
            { id: 'vendor-2', name: 'Develop Referral Pathway', start: addDays(today, 3), end: addDays(today, 8), progress: 0, owner: 'multiple', channel: 'partnerships', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'vendor-3', name: 'Design Vendor Branding', start: addDays(today, 4), end: addDays(today, 7), progress: 0, owner: 'multiple', channel: 'partnerships', campaign: 'general', priority: 'P2', status: 'not-started' },
            { id: 'vendor-4', name: 'Create co-branded posters', start: addDays(today, 5), end: addDays(today, 8), progress: 0, owner: 'dara', channel: 'partnerships', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'vendor-5', name: 'Visit vendors, distribute merch', start: addDays(today, 7), end: addDays(today, 18), progress: 0, owner: 'sales', channel: 'partnerships', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'vendor-6', name: 'Hang banners at key locations', start: addDays(today, 8), end: addDays(today, 12), progress: 0, owner: 'sales', channel: 'partnerships', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'vendor-7', name: 'Door-to-door with QR codes', start: addDays(today, 10), end: addDays(today, 18), progress: 0, owner: 'sales', channel: 'partnerships', campaign: 'general', priority: 'P2', status: 'not-started' },
            { id: 'vendor-8', name: 'Reach out to clinics/hospitals', start: addDays(today, 10), end: addDays(today, 14), progress: 0, owner: 'founders', channel: 'partnerships', campaign: 'general', priority: 'P1', status: 'not-started' },
            
            // Reports
            { id: 'report-1', name: 'Week 1 Performance Review', start: addDays(today, 6), end: addDays(today, 6), progress: 0, owner: 'founders', channel: 'paid', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'report-2', name: 'Week 2 Performance Review', start: addDays(today, 13), end: addDays(today, 13), progress: 0, owner: 'founders', channel: 'paid', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'report-3', name: 'Week 3 Performance Review', start: addDays(today, 20), end: addDays(today, 20), progress: 0, owner: 'founders', channel: 'paid', campaign: 'general', priority: 'P1', status: 'not-started' },
            { id: 'report-4', name: 'Final Report & Month 2 Plan', start: addDays(today, 26), end: addDays(today, 27), progress: 0, owner: 'multiple', channel: 'paid', campaign: 'general', priority: 'P0', status: 'not-started' },
        ];
        
        let milestones = [
            { id: 'ms-1', name: 'Campaign 1 Launch Ready', taskIds: ['paid-1', 'paid-2', 'paid-3', 'paid-4', 'paid-5', 'paid-6'], targetDate: addDays(today, 6) },
            { id: 'ms-2', name: 'WhatsApp Engine Live', taskIds: ['wa-1', 'wa-2', 'wa-3', 'wa-4'], targetDate: addDays(today, 3) },
            { id: 'ms-3', name: 'Pharmacy Network Activated', taskIds: ['pharm-1', 'pharm-3', 'pharm-4'], targetDate: addDays(today, 7) }
        ];
        
        // ==================== OWNER COLORS ====================
        const ownerColors = {
            'ruth': { bg: '#BAE6FD', progress: '#0EA5E9', dot: '#0EA5E9' },
            'dara': { bg: '#DDD6FE', progress: '#8B5CF6', dot: '#8B5CF6' },
            'founders': { bg: '#99F6E4', progress: '#14B8A6', dot: '#14B8A6' },
            'sales': { bg: '#FDE68A', progress: '#F59E0B', dot: '#F59E0B' },
            'sarah': { bg: '#FBCFE8', progress: '#EC4899', dot: '#EC4899' },
            'samuel': { bg: '#C7D2FE', progress: '#6366F1', dot: '#6366F1' },
            'multiple': { bg: '#E2E8F0', progress: '#64748B', dot: '#64748B' }
        };
        
        // ==================== RENDER GANTT ====================
        function renderGantt() {
            const headerDates = document.getElementById('ganttHeaderDates');
            const body = document.getElementById('ganttBody');
            
            // Filter tasks
            let filteredTasks = allTasks.filter(task => {
                if (currentFilter !== 'all' && task.owner !== currentFilter) return false;
                if (currentChannelFilter !== 'all' && task.channel !== currentChannelFilter) return false;
                return true;
            });
            
            // Build header dates
            let headerHTML = '';
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            for (let i = 0; i < viewDays; i++) {
                const date = new Date(viewStartDate);
                date.setDate(date.getDate() + i);
                const isToday = date.toDateString() === today.toDateString();
                const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                
                headerHTML += `
                    <div class="gantt-date-cell ${isToday ? 'today' : ''} ${isWeekend ? 'weekend' : ''}">
                        <div class="day-name">${dayNames[date.getDay()]}</div>
                        <div class="day-num">${date.getDate()}</div>
                    </div>
                `;
            }
            headerDates.innerHTML = headerHTML;
            
            // Build body
            if (filteredTasks.length === 0) {
                body.innerHTML = '<div style="padding: 50px; text-align: center; color: #64748B;">No tasks match your filter</div>';
                updateStats();
                return;
            }
            
            let bodyHTML = '<div class="gantt-scroll-wrapper"><div class="gantt-task-list">';
            
            // Task list
            filteredTasks.forEach(task => {
                const color = ownerColors[task.owner] || ownerColors.multiple;
                bodyHTML += `
                    <div class="gantt-task-item" onclick="editTask('${task.id}')">
                        <div class="owner-dot" style="background: ${color.dot}"></div>
                        <div class="task-name" title="${task.name}">${task.name}</div>
                        <div class="priority-badge priority-${task.priority}">${task.priority}</div>
                    </div>
                `;
            });
            
            bodyHTML += '</div><div class="gantt-bars-container">';
            
            // Bar rows
            filteredTasks.forEach(task => {
                const color = ownerColors[task.owner] || ownerColors.multiple;
                
                // Calculate position
                const startOffset = getDayOffset(task.start, viewStartDate);
                const duration = getDaysBetween(task.start, task.end);
                
                let barHTML = '';
                
                // Only show bar if visible in current view
                if (startOffset + duration >= 0 && startOffset < viewDays) {
                    const left = Math.max(0, startOffset) * 40;
                    const adjustedDuration = Math.min(duration, viewDays - Math.max(0, startOffset));
                    const width = adjustedDuration * 40 - 4;
                    
                    if (width > 0) {
                        barHTML = `
                            <div class="gantt-bar bar-${task.owner}" 
                                 style="left: ${left}px; width: ${width}px;" 
                                 onclick="editTask('${task.id}')"
                                 title="${task.name} (${task.progress}%)">
                                <div class="bar-progress" style="width: ${task.progress}%; background: ${color.progress}"></div>
                                <span class="bar-text">${width > 80 ? task.name.substring(0, Math.floor(width/7)) : ''}</span>
                            </div>
                        `;
                    }
                }
                
                // Build cells
                let cellsHTML = '';
                for (let i = 0; i < viewDays; i++) {
                    const date = new Date(viewStartDate);
                    date.setDate(date.getDate() + i);
                    const isToday = date.toDateString() === today.toDateString();
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    cellsHTML += `<div class="gantt-bar-cell ${isToday ? 'today' : ''} ${isWeekend ? 'weekend' : ''}"></div>`;
                }
                
                bodyHTML += `<div class="gantt-bar-row">${cellsHTML}${barHTML}</div>`;
            });
            
            bodyHTML += '</div></div>';
            body.innerHTML = bodyHTML;
            
            updateStats();
            updatePeriodDisplay();
        }
        
        // ==================== NAVIGATION ====================
        function navigateCalendar(days) {
            viewStartDate.setDate(viewStartDate.getDate() + days);
            renderGantt();
        }
        
        function goToToday() {
            viewStartDate = new Date(today);
            viewStartDate.setDate(viewStartDate.getDate() - 3);
            renderGantt();
        }
        
        function changeView(days, btn) {
            viewDays = days;
            document.querySelectorAll('.btn-view').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderGantt();
        }
        
        function updatePeriodDisplay() {
            const endDate = new Date(viewStartDate);
            endDate.setDate(endDate.getDate() + viewDays - 1);
            document.getElementById('currentPeriod').textContent = `${formatDate(viewStartDate)} - ${formatDate(endDate)}`;
        }
        
        // ==================== FILTERS ====================
        function filterTasks(owner, btn) {
            currentFilter = owner;
            document.querySelectorAll('.btn-filter').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderGantt();
        }
        
        function filterByChannel(channel) {
            currentChannelFilter = channel;
            renderGantt();
        }
        
        // ==================== STATS ====================
        function updateStats() {
            document.getElementById('total-tasks').textContent = allTasks.length;
            document.getElementById('not-started').textContent = allTasks.filter(t => t.status === 'not-started' && t.progress === 0).length;
            document.getElementById('in-progress').textContent = allTasks.filter(t => t.status === 'in-progress' || (t.progress > 0 && t.progress < 100)).length;
            document.getElementById('completed-tasks').textContent = allTasks.filter(t => t.status === 'completed' || t.progress === 100).length;
            document.getElementById('blocked-tasks').textContent = allTasks.filter(t => t.status === 'blocked').length;
            document.getElementById('total-milestones').textContent = milestones.length;
        }
        
        // ==================== CLICKABLE DASHBOARD ====================
        function showTasksByStatus(status) {
            let filtered;
            let title;
            
            switch(status) {
                case 'all':
                    filtered = allTasks;
                    title = 'All Tasks';
                    break;
                case 'not-started':
                    filtered = allTasks.filter(t => t.status === 'not-started' && t.progress === 0);
                    title = 'Not Started Tasks';
                    break;
                case 'in-progress':
                    filtered = allTasks.filter(t => t.status === 'in-progress' || (t.progress > 0 && t.progress < 100));
                    title = 'In Progress Tasks';
                    break;
                case 'completed':
                    filtered = allTasks.filter(t => t.status === 'completed' || t.progress === 100);
                    title = 'Completed Tasks';
                    break;
                case 'blocked':
                    filtered = allTasks.filter(t => t.status === 'blocked');
                    title = 'Blocked Tasks';
                    break;
            }
            
            showTaskListModal(title, filtered);
        }
        
        function showMilestonesList() {
            let html = '';
            
            if (milestones.length === 0) {
                html = '<div class="empty-state">No milestones created yet</div>';
            } else {
                milestones.forEach(m => {
                    const progress = getMilestoneProgress(m);
                    html += `
                        <div class="task-list-item" onclick="closeMilestoneListAndEdit('${m.id}')">
                            <div class="owner-indicator" style="background: linear-gradient(to bottom, #F59E0B, #D97706);"></div>
                            <div class="task-info">
                                <div class="task-name">${m.name}</div>
                                <div class="task-meta">${m.taskIds.length} tasks ‚Ä¢ Target: ${m.targetDate ? new Date(m.targetDate).toLocaleDateString() : 'Not set'}</div>
                            </div>
                            <div class="task-progress">
                                <div class="progress-circle" style="background: ${progress === 100 ? '#10B981' : '#F59E0B'}; color: white;">
                                    ${progress}%
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('taskListTitle').textContent = 'Milestones';
            document.getElementById('taskListContainer').innerHTML = html;
            document.getElementById('taskListModal').classList.add('show');
        }
        
        function showTaskListModal(title, tasks) {
            let html = '';
            
            if (tasks.length === 0) {
                html = '<div class="empty-state">No tasks in this category</div>';
            } else {
                tasks.forEach(task => {
                    const color = ownerColors[task.owner] || ownerColors.multiple;
                    const progressColor = task.progress === 100 ? '#10B981' : task.progress > 0 ? '#3B82F6' : '#64748B';
                    
                    html += `
                        <div class="task-list-item" onclick="closeTaskListAndEdit('${task.id}')">
                            <div class="owner-indicator" style="background: ${color.dot};"></div>
                            <div class="task-info">
                                <div class="task-name">${task.name}</div>
                                <div class="task-meta">${task.owner} ‚Ä¢ ${task.channel} ‚Ä¢ ${task.start} to ${task.end}</div>
                            </div>
                            <div class="task-progress">
                                <div class="progress-circle" style="background: ${progressColor}; color: white;">
                                    ${task.progress}%
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('taskListTitle').textContent = title + ` (${tasks.length})`;
            document.getElementById('taskListContainer').innerHTML = html;
            document.getElementById('taskListModal').classList.add('show');
        }
        
        function closeTaskListModal() {
            document.getElementById('taskListModal').classList.remove('show');
        }
        
        function closeTaskListAndEdit(taskId) {
            closeTaskListModal();
            setTimeout(() => editTask(taskId), 100);
        }
        
        function closeMilestoneListAndEdit(milestoneId) {
            closeTaskListModal();
            // Could implement milestone editing here
        }
        
        // ==================== TASK MODAL ====================
        function openTaskModal() {
            editingTaskId = null;
            document.getElementById('taskModalTitle').textContent = 'Add New Task';
            document.getElementById('taskName').value = '';
            document.getElementById('taskChannel').value = 'paid';
            document.getElementById('taskCampaign').value = 'general';
            document.getElementById('taskOwner').value = 'ruth';
            document.getElementById('taskStart').value = addDays(today, 0);
            document.getElementById('taskEnd').value = addDays(today, 2);
            document.getElementById('taskPriority').value = 'P1';
            document.getElementById('taskProgress').value = 0;
            document.getElementById('taskStatus').value = 'not-started';
            document.getElementById('deleteTaskBtn').style.display = 'none';
            document.getElementById('taskModal').classList.add('show');
        }
        
        function editTask(taskId) {
            editingTaskId = taskId;
            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('taskModalTitle').textContent = 'Edit Task';
            document.getElementById('taskName').value = task.name;
            document.getElementById('taskChannel').value = task.channel;
            document.getElementById('taskCampaign').value = task.campaign;
            document.getElementById('taskOwner').value = task.owner;
            document.getElementById('taskStart').value = task.start;
            document.getElementById('taskEnd').value = task.end;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskProgress').value = task.progress;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('deleteTaskBtn').style.display = 'inline-block';
            document.getElementById('taskModal').classList.add('show');
        }
        
        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('show');
            editingTaskId = null;
        }
        
        async function saveTask() {
    const name = document.getElementById('taskName').value.trim();
    if (!name) { alert('Please enter a task name'); return; }
    
    const taskData = {
        name,
        channel: document.getElementById('taskChannel').value,
        campaign: document.getElementById('taskCampaign').value,
        owner: document.getElementById('taskOwner').value,
        start: document.getElementById('taskStart').value,
        end: document.getElementById('taskEnd').value,
        priority: document.getElementById('taskPriority').value,
        progress: parseInt(document.getElementById('taskProgress').value),
        status: document.getElementById('taskStatus').value
    };
    
    if (taskData.progress === 100) taskData.status = 'completed';
    else if (taskData.progress > 0) taskData.status = 'in-progress';
    
    if (editingTaskId) {
        const idx = allTasks.findIndex(t => t.id === editingTaskId);
        if (idx !== -1) {
            allTasks[idx] = { ...allTasks[idx], ...taskData };
            await updateTaskInAPI(allTasks[idx]);
        }
    } else {
        const newTask = { id: `task-${Date.now()}`, ...taskData };
        const savedTask = await saveTaskToAPI(newTask);
        if (savedTask) {
            allTasks.push(savedTask);
        } else {
            allTasks.push(newTask);
        }
    }
    
    renderGantt();
    renderMilestones();
    closeTaskModal();
}
            
            renderGantt();
            renderMilestones();
            closeTaskModal();
        }
        
        async function deleteTask() {
    if (!editingTaskId) return;
    if (confirm('Delete this task?')) {
        await deleteTaskFromAPI(editingTaskId);
        allTasks = allTasks.filter(t => t.id !== editingTaskId);
        milestones.forEach(m => m.taskIds = m.taskIds.filter(id => id !== editingTaskId));
        renderGantt();
        renderMilestones();
        closeTaskModal();
    }
}
        
        // ==================== MILESTONE MODAL ====================
        function openMilestoneModal() {
            document.getElementById('milestoneName').value = '';
            document.getElementById('milestoneDate').value = addDays(today, 7);
            
            const selection = document.getElementById('taskSelection');
            selection.innerHTML = allTasks.map(t => `
                <div class="task-selection-item">
                    <input type="checkbox" id="sel-${t.id}" value="${t.id}" onchange="updateSelectedCount()">
                    <label for="sel-${t.id}">${t.name}</label>
                </div>
            `).join('');
            
            updateSelectedCount();
            document.getElementById('milestoneModal').classList.add('show');
        }
        
        function closeMilestoneModal() {
            document.getElementById('milestoneModal').classList.remove('show');
        }
        
        function updateSelectedCount() {
            const count = document.querySelectorAll('#taskSelection input:checked').length;
            document.getElementById('selectedCount').textContent = `${count} task${count !== 1 ? 's' : ''} selected`;
        }
        
        function saveMilestone() {
            const name = document.getElementById('milestoneName').value.trim();
            const taskIds = Array.from(document.querySelectorAll('#taskSelection input:checked')).map(cb => cb.value);
            
            if (!name) { alert('Please enter a milestone name'); return; }
            if (taskIds.length === 0) { alert('Please select at least one task'); return; }
            
            milestones.push({
                id: `ms-${Date.now()}`,
                name,
                taskIds,
                targetDate: document.getElementById('milestoneDate').value
            });
            
            renderMilestones();
            updateStats();
            closeMilestoneModal();
        }
        
        function deleteMilestone(id) {
            if (confirm('Delete this milestone?')) {
                milestones = milestones.filter(m => m.id !== id);
                renderMilestones();
                updateStats();
            }
        }
        
        function getMilestoneProgress(m) {
            if (m.taskIds.length === 0) return 0;
            const done = m.taskIds.filter(id => {
                const t = allTasks.find(task => task.id === id);
                return t && (t.progress === 100 || t.status === 'completed');
            }).length;
            return Math.round((done / m.taskIds.length) * 100);
        }
        
        function renderMilestones() {
            const grid = document.getElementById('milestonesGrid');
            
            if (milestones.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 30px; grid-column: 1/-1;">No milestones yet. Click "+ New" to create one.</p>';
                return;
            }
            
            grid.innerHTML = milestones.map(m => {
                const progress = getMilestoneProgress(m);
                return `
                    <div class="milestone-card ${progress === 100 ? 'completed' : ''}">
                        <button class="delete-btn" onclick="deleteMilestone('${m.id}')">√ó</button>
                        <div class="milestone-title">${m.name}</div>
                        <div class="milestone-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <span class="progress-text">${progress}%</span>
                        </div>
                        <div class="task-count">${m.taskIds.length} tasks ‚Ä¢ Target: ${m.targetDate ? new Date(m.targetDate).toLocaleDateString() : 'Not set'}</div>
                    </div>
                `;
            }).join('');
        }
        
        // ==================== EXPORT ====================
        function exportTasks() {
            const csv = [
                ['Name', 'Owner', 'Channel', 'Start', 'End', 'Priority', 'Status', 'Progress'].join(','),
                ...allTasks.map(t => [
                    `"${t.name}"`, t.owner, t.channel, t.start, t.end, t.priority, t.status, t.progress
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `wellwallet_tasks_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }
        
        // ==================== INIT ====================
        document.getElementById('taskModal').addEventListener('click', e => { if (e.target.id === 'taskModal') closeTaskModal(); });
        document.getElementById('milestoneModal').addEventListener('click', e => { if (e.target.id === 'milestoneModal') closeMilestoneModal(); });
        document.getElementById('taskListModal').addEventListener('click', e => { if (e.target.id === 'taskListModal') closeTaskListModal(); });
        
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') { closeTaskModal(); closeMilestoneModal(); closeTaskListModal(); }
        });
        
        // Initial render - Load from API
loadTasks();
    </script>
</body>
</html>
